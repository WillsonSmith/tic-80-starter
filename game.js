/**
 * // title: Hello world
 * // author: Willson Smith
 * // desc: A hello world game
 * // script: js
 */

var Color;(function(a){a[a.Black=0]="Black",a[a.DarkRed=1]="DarkRed",a[a.DarkBlue=2]="DarkBlue",a[a.DarkGray=3]="DarkGray",a[a.Brown=4]="Brown",a[a.DarkGreen=5]="DarkGreen",a[a.Red=6]="Red",a[a.LightGray=7]="LightGray",a[a.LightBlue=8]="LightBlue",a[a.Orange=9]="Orange",a[a.BlueGray=10]="BlueGray",a[a.LightGreen=11]="LightGreen",a[a.Peach=12]="Peach",a[a.Cyan=13]="Cyan",a[a.Yellow=14]="Yellow",a[a.White=15]="White"})(Color||(Color={}));var Button;(function(a){a[a.Up=0]="Up",a[a.Down=1]="Down",a[a.Left=2]="Left",a[a.Right=3]="Right",a[a.A=4]="A",a[a.B=5]="B"})(Button||(Button={}));function distanceBetween(a){var b=a.x,c=a.y;return Math.sqrt(b*b+c*c)}function vectorBetween(a,b){return{toX:a.x-b.x,toY:a.y-b.y}}function direction(a){var b=a*(180/Math.PI);return{x:Math.sin(b),y:Math.cos(b)}}var Ray=/** @class */function(){function a(a,b){this.position=a,this.direction=direction(b)}return a.prototype.setAngle=function(a){this.direction=direction(a)},a.prototype.drawTo=function(a,b){line(this.position.x,this.position.y,a,b,Color.White)},a.prototype.rayLength=function(a){var b=vectorBetween({x:this.position.x,y:this.position.y},a);return distanceBetween({x:b.toX,y:b.toY})},a.prototype.draw=function(){line(this.position.x,this.position.y,this.position.x+1e3*this.direction.x,this.position.y+1e3*this.direction.y,Color.DarkBlue)},a.prototype.cast=function(a){var b=a.a,c=b.x,d=b.y,e=a.b,f=e.x,g=e.y,h=this.position,i=h.x,j=h.y,k=i+this.direction.x,l=j+this.direction.y,m=(c-f)*(j-l)-(d-g)*(i-k);if(0!==m){var n=((c-i)*(j-l)-(d-j)*(i-k))/m;if(0<n&&1>n&&0<-((c-f)*(d-j)-(d-g)*(c-i))/m)return{x:c+n*(f-c),y:d+n*(g-d)}}},a}(),Block=/** @class */function(){function a(a,b,c,d,e,f){this.observing=!1,this.moving=!1,this.speed=1,this.targetInVision=null,this.x=b,this.y=c,this.w=d,this.h=e,this.color=f,this.rays=[],this.type=a}return Object.defineProperty(a.prototype,"bounds",{get:function(){var a=this,b=a.x,c=a.y,d=a.w,e=a.h;return[{a:{x:b,y:c},b:{x:b+d,y:c}},{a:{x:b+d,y:c},b:{x:b+d,y:c+e}},{a:{x:b,y:c+e},b:{x:b+d,y:c+e}},{a:{x:b,y:c+e},b:{x:b,y:c}}]},enumerable:!0,configurable:!0}),a.prototype.detect=function(a){var b=this;this.observing=!0,this.targetInVision=null,this.rays.forEach(function(c){var d=null;a.forEach(function(a){a.bounds.forEach(function(e){var f=c.cast(e);if(f/* && ray.rayLength(intersect) < 50 //vision */){var g=c.rayLength(f);d?g<d[1]&&(d[0]=e,d[1]=g):d=[e,g],d[0]===e&&c.drawTo(f.x,f.y),b.targetInVision=a}})})})},a.prototype.draw=function(){var a=this,b=a.x,c=a.y,d=a.w,e=a.h,f=a.color,g={x:b+d/2,y:c+e/2};if(this.observing){this.rays.length=0;for(var h=0;180>h;h+=5)this.rays.push(new Ray({x:g.x,y:g.y},h))}return"wall"===this.type?rectb(b,c,d,e,f):rect(b,c,d,e,f)},a.prototype.follow=function(a){var b=a.x,c=a.y,d=vectorBetween({x:b,y:c},{x:this.x,y:this.y}),e=distanceBetween({x:d.toX,y:d.toY});a.moving&&this.targetInVision&&(this.x+=d.toX/e*this.speed,this.y+=d.toY/e*this.speed)},a}(),gameState={player:new Block("player",84,84,6,6,Color.Red),enemies:[new Block("enemy",20,20,6,6,Color.DarkGreen),new Block("enemy",200,50,6,6,Color.LightBlue)],walls:[// new Block(0, 0, 1, 136, Color.DarkGreen),
// new Block(239, 0, 1, 136, Color.DarkGreen),
// new Block(0, 0, 240, 1, Color.DarkGreen),
// new Block(0, 135, 240, 1, Color.DarkGreen)
new Block("wall",110,0,15,110,Color.Yellow)]};function TIC(){var a=gameState.player,b=gameState.enemies,c=gameState.walls,d=a.speed;a.moving=!1,btn()&&(a.moving=!0);btn(Button.Up)&&(a.y-=1*d),btn(Button.Down)&&(a.y+=1*d),btn(Button.Left)&&(a.x-=1*d),btn(Button.Right)&&(a.x+=1*d),cls(Color.Black),c.forEach(function(a){return a.draw()}),b.forEach(function(b){b.speed=.5,b.draw(),b.follow(a),b.detect([a].concat(c))}),a.draw()}
